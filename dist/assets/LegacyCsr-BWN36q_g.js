/* empty css             *//* empty css                 *//* empty css                             *//* empty css               */import"./request-DHoSJWvM.js";/* empty css                *//* empty css                  *//* empty css                 */import{a as T,o as y,c as N,b as s,e,w as t,s as k,y as x,r as S,D as B,K as L,L as j,M as q,N as F,u as m,O as z,h as Q,E as G,P as J,p as u,Q as O,J as K,j as X,x as p,R as $,S as h,G as H,U as E,I as W,V as Y,_ as Z}from"./index-Cj9AfTnA.js";import{e as ee}from"./enroll-osQp5diG.js";const le={class:"flex gap-2 w-full"},te={class:"mt-4"},ae={class:"flex items-center justify-between mb-2"},se={class:"flex gap-2"},oe={class:"pem-block"},ne=T({__name:"LegacyCsr",setup(re){const C=S(),g=S(!1),a=S(null),n=H({principalCode:"",csrPem:"",nonce:""}),w={principalCode:[{required:!0,message:"请输入主体编码",trigger:"blur"}],csrPem:[{required:!0,message:"请输入 SM2 CSR (PEM 格式)",trigger:"blur"}],nonce:[{required:!0,message:"请输入或生成随机数 Nonce",trigger:"blur"}]};function V(){const o=new Uint8Array(16);crypto.getRandomValues(o),n.nonce=Array.from(o,l=>l.toString(16).padStart(2,"0")).join("")}async function I(){var l;if(await((l=C.value)==null?void 0:l.validate().catch(()=>!1))){g.value=!0;try{a.value=await ee({...n}),a.value.status==="ISSUED"?E.success("证书签发成功！"):a.value.status==="REJECTED"&&E.warning("CSR 验签失败，证书签发被拒绝")}catch{}finally{g.value=!1}}}function U(){var o;(o=a.value)!=null&&o.message&&(navigator.clipboard.writeText(a.value.message),E.success("证书 PEM 已复制到剪贴板"))}function D(){var i;if(!((i=a.value)!=null&&i.message))return;const o=new Blob([a.value.message],{type:"application/x-pem-file"}),l=URL.createObjectURL(o),r=document.createElement("a");r.href=l,r.download=`certificate-${a.value.requestId||"cert"}.pem`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l),E.success("证书文件已开始下载")}function M(){var o;(o=C.value)==null||o.resetFields(),a.value=null}return(o,l)=>{const r=F,i=q,f=G,d=Q,P=L,b=B,_=X,v=K,R=W,A=Y;return y(),N("div",null,[l[11]||(l[11]=s("div",{class:"page-header"},[s("h2",null,"标准国密证书申请"),s("p",null,"提交 SM2 CSR 进行传统国密证书签发")],-1)),e(b,null,{default:t(()=>[e(P,{ref_key:"formRef",ref:C,model:n,rules:w,"label-position":"top",onSubmit:j(I,["prevent"])},{default:t(()=>[e(i,{label:"申请主体编码 (Principal Code)",prop:"principalCode"},{default:t(()=>[e(r,{modelValue:n.principalCode,"onUpdate:modelValue":l[0]||(l[0]=c=>n.principalCode=c),placeholder:"请输入设备/主体唯一编码，如 DEVICE-A1B2C3D4","prefix-icon":m(z)},null,8,["modelValue","prefix-icon"])]),_:1}),e(i,{label:"SM2 CSR (PEM 格式)",prop:"csrPem"},{default:t(()=>[e(r,{modelValue:n.csrPem,"onUpdate:modelValue":l[1]||(l[1]=c=>n.csrPem=c),type:"textarea",rows:8,placeholder:`-----BEGIN CERTIFICATE REQUEST-----
MIIBojCCAUcCAQAwXzELMAkGA1UE...
-----END CERTIFICATE REQUEST-----`},null,8,["modelValue"])]),_:1}),e(i,{label:"随机数 (Nonce)",prop:"nonce"},{default:t(()=>[s("div",le,[e(r,{modelValue:n.nonce,"onUpdate:modelValue":l[2]||(l[2]=c=>n.nonce=c),placeholder:"防重放随机数"},null,8,["modelValue"]),e(d,{onClick:V,type:"info",plain:""},{default:t(()=>[e(f,{class:"mr-1"},{default:t(()=>[e(m(J))]),_:1}),l[3]||(l[3]=u(" 生成 ",-1))]),_:1})])]),_:1}),e(i,null,{default:t(()=>[e(d,{type:"primary",loading:g.value,onClick:I,size:"large"},{default:t(()=>[e(f,{class:"mr-1"},{default:t(()=>[e(m(O))]),_:1}),l[4]||(l[4]=u(" 提交申请 ",-1))]),_:1},8,["loading"]),e(d,{onClick:M,size:"large"},{default:t(()=>[...l[5]||(l[5]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a.value&&a.value.status==="ISSUED"?(y(),k(b,{key:0,class:"mt-6"},{header:t(()=>[...l[6]||(l[6]=[s("div",{class:"flex items-center gap-2"},[s("span",{class:"result-icon result-icon--success"},"✅"),s("span",{class:"font-semibold"},"证书签发成功")],-1)])]),default:t(()=>[e(R,{column:1,border:""},{default:t(()=>[e(v,{label:"请求 ID"},{default:t(()=>[e(_,{effect:"dark"},{default:t(()=>[u(p(a.value.requestId),1)]),_:1})]),_:1}),e(v,{label:"状态"},{default:t(()=>[e(_,{type:"success",effect:"dark"},{default:t(()=>[u(p(a.value.status),1)]),_:1})]),_:1})]),_:1}),s("div",te,[s("div",ae,[l[9]||(l[9]=s("span",{class:"text-sm font-medium text-slate-400"},"签发证书 PEM",-1)),s("div",se,[e(d,{size:"small",text:"",onClick:U},{default:t(()=>[e(f,{class:"mr-1"},{default:t(()=>[e(m($))]),_:1}),l[7]||(l[7]=u(" 复制 ",-1))]),_:1}),e(d,{size:"small",text:"",onClick:D},{default:t(()=>[e(f,{class:"mr-1"},{default:t(()=>[e(m(h))]),_:1}),l[8]||(l[8]=u(" 下载 ",-1))]),_:1})])]),s("pre",oe,p(a.value.message),1)])]),_:1})):x("",!0),a.value&&a.value.status==="REJECTED"?(y(),k(b,{key:1,class:"mt-6"},{header:t(()=>[...l[10]||(l[10]=[s("div",{class:"flex items-center gap-2"},[s("span",{class:"result-icon result-icon--error"},"❌"),s("span",{class:"font-semibold"},"证书签发被拒绝")],-1)])]),default:t(()=>[e(R,{column:1,border:""},{default:t(()=>[e(v,{label:"请求 ID"},{default:t(()=>[e(_,{effect:"dark"},{default:t(()=>[u(p(a.value.requestId),1)]),_:1})]),_:1}),e(v,{label:"状态"},{default:t(()=>[e(_,{type:"danger",effect:"dark"},{default:t(()=>[u(p(a.value.status),1)]),_:1})]),_:1})]),_:1}),e(A,{class:"mt-4",title:"CSR 签名验证失败",description:"提交的 SM2 CSR 签名验证未通过，请检查 CSR 的完整性及签名是否正确后重新提交。",type:"error","show-icon":"",closable:!1})]),_:1})):x("",!0)])}}}),Ce=Z(ne,[["__scopeId","data-v-ca404f77"]]);export{Ce as default};
