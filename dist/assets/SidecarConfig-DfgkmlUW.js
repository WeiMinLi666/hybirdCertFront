/* empty css             */import{a as V,b as B}from"./admin-Bo33Owj6.js";/* empty css                *//* empty css                  *//* empty css                 *//* empty css                 */import"./request-DHoSJWvM.js";import{a as L,B as U,o as r,c as h,b as s,l as P,aa as R,s as k,w as o,e as l,r as d,D as A,G as O,x as n,ab as $,K as z,L as D,M as q,N as F,ac as G,h as K,E as j,u as y,af as H,p as M,P as J,U as Q,_ as W}from"./index-Cj9AfTnA.js";const X={key:0,class:"config-info-grid"},Y={class:"config-info-item"},Z={class:"info-value"},ee={class:"config-info-item"},se={class:"info-value highlight"},te={class:"config-info-item"},le={class:"info-value highlight"},ae={class:"config-info-item"},oe={class:"info-value"},ie={class:"config-info-item"},ne={class:"info-value"},re={class:"grid grid-cols-1 lg:grid-cols-2 gap-x-6"},de={class:"readonly-section"},ue={class:"readonly-grid"},ce={class:"readonly-item"},fe={class:"readonly-value"},me={class:"readonly-item"},pe={class:"readonly-value"},ve=L({__name:"SidecarConfig",setup(_e){const v=d(),u=d(!1),c=d(!1),i=d(null),a=O({storageProvider:"MINIO",bucket:"sidecar",urlTtlSeconds:604800,hashAlg:"SM3",merkleParams:"",version:0}),x={bucket:[{required:!0,message:"桶名称不能为空",trigger:"blur"}],urlTtlSeconds:[{required:!0,message:"请设置 URL 有效期",trigger:"change"}]};function I(t){return t?t>=86400?`${Math.floor(t/86400)} 天 (${t}s)`:t>=3600?`${Math.floor(t/3600)} 小时 (${t}s)`:`${t} 秒`:"未设置"}async function f(){u.value=!0;try{const t=await V();i.value=t,t&&(a.bucket=t.bucket||"sidecar",a.urlTtlSeconds=t.urlTtlSeconds||604800,a.storageProvider=t.storageProvider||"MINIO",a.hashAlg=t.hashAlg||"SM3")}catch{i.value=null}finally{u.value=!1}}async function _(){var e;if(await((e=v.value)==null?void 0:e.validate().catch(()=>!1))){c.value=!0;try{await B({...a}),Q.success("Sidecar 配置已更新"),await f()}catch{}finally{c.value=!1}}}return U(()=>{f()}),(t,e)=>{const E=$,g=A,C=F,m=q,T=G,b=j,S=K,w=z,N=R;return r(),h("div",null,[e[16]||(e[16]=s("div",{class:"page-header"},[s("h2",null,"Sidecar 存储配置"),s("p",null,"管理 Sidecar 对象存储的桶名与预签名 URL 有效期")],-1)),P((r(),k(g,{class:"mb-6"},{header:o(()=>[...e[2]||(e[2]=[s("span",{class:"font-semibold"},"当前生效配置",-1)])]),default:o(()=>[i.value?(r(),h("div",X,[s("div",Y,[e[3]||(e[3]=s("span",{class:"label"},"存储提供商",-1)),s("code",Z,n(i.value.storageProvider||"MINIO"),1)]),s("div",ee,[e[4]||(e[4]=s("span",{class:"label"},"Bucket",-1)),s("code",se,n(i.value.bucket||"未设置"),1)]),s("div",te,[e[5]||(e[5]=s("span",{class:"label"},"URL 有效期",-1)),s("code",le,n(I(i.value.urlTtlSeconds)),1)]),s("div",ae,[e[6]||(e[6]=s("span",{class:"label"},"哈希算法",-1)),s("code",oe,n(i.value.hashAlg||"SM3"),1)]),s("div",ie,[e[7]||(e[7]=s("span",{class:"label"},"版本",-1)),s("code",ne,"v"+n(i.value.version),1)])])):(r(),k(E,{key:1,description:"暂无配置，请在下方创建","image-size":60}))]),_:1})),[[N,u.value]]),l(g,null,{header:o(()=>[...e[8]||(e[8]=[s("span",{class:"font-semibold"},"更新配置",-1)])]),default:o(()=>[l(w,{ref_key:"formRef",ref:v,model:a,rules:x,"label-position":"top",onSubmit:D(_,["prevent"])},{default:o(()=>[s("div",re,[l(m,{label:"Bucket 名称",prop:"bucket"},{default:o(()=>[l(C,{modelValue:a.bucket,"onUpdate:modelValue":e[0]||(e[0]=p=>a.bucket=p),placeholder:"例：sidecar"},null,8,["modelValue"]),e[9]||(e[9]=s("div",{class:"text-xs text-slate-500 mt-1"},"MinIO 对象存储桶，修改后新上传的对象将写入此桶",-1))]),_:1}),l(m,{label:"预签名 URL 有效期（秒）",prop:"urlTtlSeconds"},{default:o(()=>[l(T,{modelValue:a.urlTtlSeconds,"onUpdate:modelValue":e[1]||(e[1]=p=>a.urlTtlSeconds=p),min:60,max:604800,step:3600,class:"w-full"},null,8,["modelValue"]),e[10]||(e[10]=s("div",{class:"text-xs text-slate-500 mt-1"},"预签名 URL 过期时间，最大 604800 秒（7 天）",-1))]),_:1})]),s("div",de,[e[13]||(e[13]=s("div",{class:"section-label"},"以下配置由系统固定，不可修改",-1)),s("div",ue,[s("div",ce,[e[11]||(e[11]=s("span",{class:"label"},"存储提供商",-1)),s("code",fe,n(a.storageProvider||"MINIO"),1)]),s("div",me,[e[12]||(e[12]=s("span",{class:"label"},"哈希算法",-1)),s("code",pe,n(a.hashAlg||"SM3"),1)])])]),l(m,{class:"mt-6"},{default:o(()=>[l(S,{type:"primary",loading:c.value,onClick:_,size:"large"},{default:o(()=>[l(b,{class:"mr-1"},{default:o(()=>[l(y(H))]),_:1}),e[14]||(e[14]=M(" 保存配置 ",-1))]),_:1},8,["loading"]),l(S,{onClick:f,size:"large"},{default:o(()=>[l(b,{class:"mr-1"},{default:o(()=>[l(y(J))]),_:1}),e[15]||(e[15]=M(" 刷新 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),Ie=W(ve,[["__scopeId","data-v-3c4b2224"]]);export{Ie as default};
